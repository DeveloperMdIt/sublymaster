name: Deploy to Netcup

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # ErmÃ¶glicht manuelles Triggern

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸš€ Deploy Application
      run: |
        cd /var/www/sublymaster
        
        # Git Pull
        echo "ğŸ“¥ Pulling latest code..."
        git pull origin main
        
        # Backend Deployment
        echo "ğŸ”§ Deploying Backend..."
        cd backend
        npm install --production
        mkdir -p logs
        pm2 restart sublymaster-backend || pm2 start index.js --name sublymaster-backend
        
        # Frontend Deployment
        echo "ğŸ¨ Deploying Frontend..."
        cd ../frontend
        npm install
        npm run build
        
        # Apache Reload
        echo "ğŸ”„ Reloading Apache..."
        sudo systemctl reload apache2 || true
        
        echo "âœ… Deployment completed!"
        pm2 status
    
    - name: ğŸ“Š Deployment Status
      if: success()
      run: echo "âœ… Deployment to sublymaster.de successful!"
    
    - name: âŒ Deployment Failed
      if: failure()
      run: echo "âŒ Deployment failed! Check logs."
